<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>BBS II Wolfsburg – Unsere Podcasts</title>
  <link rel="alternate" type="application/rss+xml" title="BBS2 Podcasts RSS" href="/feed.xml">
  <link rel="preload" href="/images/header-bg.jpg" as="image">
  <link rel="stylesheet" href="/css/variables.css">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/admin/admin.css">
  <style>
    .filter-dropdown {
      position: relative;
    }
    .filter-dropdown-button {
      min-width: 120px;
    }
    .filter-panel {
      position: absolute;
      right: 0;
      top: calc(100% + 0.5rem);
      z-index: 20;
      background: #ffffff;
      border-radius: 12px;
      border: 1px solid var(--color-border);
      padding: 1rem 1.25rem;
      min-width: 240px;
    }
    .filter-panel h3 {
      margin: 0 0 0.75rem 0;
      font-size: 0.95rem;
      font-weight: 600;
      color: var(--color-text);
    }
    .filter-row {
      margin-bottom: 0.75rem;
      font-size: 0.9rem;
    }
    .filter-row label {
      display: flex;
      align-items: center;
      gap: 0.35rem;
      margin-bottom: 0.25rem;
    }
    .filter-row select {
      width: 100%;
      box-sizing: border-box;
      font-size: 0.9rem;
      padding: 0.4rem 0.5rem;
    }
    .filter-actions {
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }

    /* Show hero background image again on the main page */
    .home-hero .hero {
      position: relative;
      background-image: url('/images/header-bg.jpg');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      color: var(--color-white);
    }
    .home-hero .hero::before {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(160deg, rgba(30, 58, 95, 0.2) 0%, rgba(21, 42, 69, 0.7) 100%);
      z-index: 0;
    }
    .home-hero .hero > * {
      position: relative;
      z-index: 1;
    }
  </style>
</head>
<body class="admin-page home-hero">
  <div class="top-hero">
    <header class="site-header">
      <div class="site-header-bg">
        <img src="/images/header-bg.jpg" alt="BBS II Wolfsburg – Schulgebäude" width="2048" height="1363" loading="eager" decoding="async" class="site-header-img">
      </div>
      <div class="site-header-overlay">
        <a href="/" class="site-logo">
          <img src="/images/logo_bbs2wob.png" alt="BBS II Wolfsburg">
          <span>Berufsbildende Schulen</span>
        </a>
        <nav class="site-nav">
          <a href="/alle-podcasts.html">Alle Podcasts</a>
          <a href="/statistik.html">Statistik</a>
          <a href="/feed.xml" class="nav-link-rss" title="RSS-Feed abonnieren">RSS</a>
          <a href="/admin/" class="btn btn-primary">Anmelden</a>
        </nav>
      </div>
    </header>

    <section class="hero">
      <div class="hero-inner">
        <h1>Unsere Schule – Unsere Podcasts</h1>
        <p class="hero-sub">Hier findest du alle Folgen, die an der BBS2 produziert werden.</p>
        <div class="search-bar-wrap">
          <label for="search-main" class="visually-hidden">Podcasts durchsuchen</label>
          <input type="search" id="search-main" class="search-input" placeholder="Podcasts durchsuchen (Titel, Beschreibung, Reihe…)">
          <button type="button" id="search-btn" class="search-btn" aria-label="Suchen">
            <span class="search-btn-label">Suchen</span>
          </button>
        </div>
      </div>
    </section>
  </div>

  <main class="container">
    <section class="section intro-section">
      <h2>Willkommen bei den BBS2-Podcasts</h2>
      <p>Von Interviews bis zu Projekten aus dem Unterricht – hör rein und bleib auf dem Laufenden, was an der BBS2 passiert.</p>
    </section>

    <section class="section stats-inline">
      <p class="stats-plain" id="stats">
        <span class="stat-num" id="stat-episodes">0</span>
        <span class="stat-label">Episoden</span>
        <span class="stat-sep" aria-hidden="true">·</span>
        <span class="stat-num" id="stat-hours">0</span>
        <span class="stat-label">Stunden abspielbar</span>
      </p>
    </section>

    <section class="section">
      <h2>Unser letzter Upload</h2>
      <div id="latest-upload"></div>
    </section>

    <section class="section">
      <div class="section-toolbar">
        <h2 class="section-title">Podcasts entdecken</h2>
        <a href="/alle-podcasts.html" id="link-alle" class="link-alle">Alle anzeigen</a>
      </div>
      <div id="podcast-rows"></div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="footer-content">
      <div>
        <strong>BBS II Wolfsburg</strong><br>
        Berufsbildende Schulen<br>
        <span class="footer-tagline">Denn es ist Deine Zukunft.</span>
      </div>
      <div>
        Kleiststraße 44, 38440 Wolfsburg | Tel 05361 261-200<br>
        Dieselstraße 46, 38446 Wolfsburg | Tel 05361 85692-0
      </div>
    </div>
    <div class="footer-links">
      <a href="/feed.xml">RSS-Feed</a> |
      <a href="https://bbs2-wob.de/impressum/">Impressum</a> |
      <a href="https://bbs2-wob.de/datenschutzerklaerung/">Datenschutzerklärung</a>
    </div>
  </footer>

  <script src="/js/app.js"></script>
  <script>
    const API = '/api';
    (async () => {
      try {
        const stats = await fetch(API + '/stats').then(r => r.json());
        const statEp = document.getElementById('stat-episodes');
        const statH = document.getElementById('stat-hours');
        if (statEp) statEp.textContent = stats.episodeCount ?? 0;
        if (statH) statH.textContent = stats.streamableHours ?? 0;
      } catch (_) {}

      const ep = await fetch(API + '/episodes?limit=1').then(r => r.json());
      const latest = ep.episodes?.[0];
      const latestEl = document.getElementById('latest-upload');
      latestEl.innerHTML = latest ? renderPodcastCard(latest) : '<p>Noch keine Podcasts vorhanden.</p>';

      const searchMain = document.getElementById('search-main');
      const linkAlle = document.getElementById('link-alle');

      if (searchMain) {
        const goToSearch = () => {
          const q = searchMain.value.trim();
          const params = new URLSearchParams();
          if (q) params.set('q', q);
          window.location.href = '/alle-podcasts.html' + (params.toString() ? '?' + params.toString() : '');
        };
        searchMain.onkeydown = (e) => { if (e.key === 'Enter') { e.preventDefault(); goToSearch(); } };
        document.getElementById('search-btn')?.addEventListener('click', goToSearch);
      }

      // Disney+/Streaming-ähnliche horizontale Reihen
      const rowsRoot = document.getElementById('podcast-rows');
      if (rowsRoot) {
        const list = await fetch(API + '/episodes?limit=200').then(r => r.json());
        const episodes = list.episodes || [];

        // Reihe 1: Alle Veröffentlichungen (neueste zuerst)
        const allRow = document.createElement('section');
        allRow.className = 'category-row';
        allRow.innerHTML = `
          <div class="category-row-header">
            <h3 class="category-row-title">Alle Veröffentlichungen</h3>
            <a class="category-row-link" href="/alle-podcasts.html">Mehr</a>
          </div>
          <div class="category-row-list"></div>
        `;
        rowsRoot.appendChild(allRow);
        const allListEl = allRow.querySelector('.category-row-list');
        episodes.slice(0, 12).forEach((epItem) => {
          allListEl.insertAdjacentHTML('beforeend', renderPodcastCard(epItem));
        });

        // Weitere Reihen: nach Kategorie gruppiert (Top nach Anzahl)
        const byCategory = {};
        for (const epItem of episodes) {
          const cat = (epItem.category || '').trim();
          if (!cat) continue;
          if (!byCategory[cat]) byCategory[cat] = [];
          byCategory[cat].push(epItem);
        }
        const sortedCats = Object.entries(byCategory)
          .sort((a, b) => b[1].length - a[1].length);

        for (const [catName, catEpisodes] of sortedCats) {
          if (!catEpisodes.length) continue;
          const row = document.createElement('section');
          row.className = 'category-row';
          row.innerHTML = `
            <div class="category-row-header">
              <h3 class="category-row-title">${escapeHtml(catName)}</h3>
              <a class="category-row-link" href="/alle-podcasts.html?category=${encodeURIComponent(catName)}">Mehr</a>
            </div>
            <div class="category-row-list"></div>
          `;
          rowsRoot.appendChild(row);
          const rowListEl = row.querySelector('.category-row-list');
          catEpisodes.slice(0, 12).forEach((epItem) => {
            rowListEl.insertAdjacentHTML('beforeend', renderPodcastCard(epItem));
          });
        }
      }
    })();
  </script>
</body>
</html>
